<p class="govuk-body">
  <% if @application_form.submitted? && @application_form.application_references.count < 2 && FeatureFlag.active?('candidate_cancels_reference') %>
    <%= t('application_form.referees.info.after_submission_with_replacement_needed') %>
  <% elsif @application_form.submitted?  %>
    <%= t('application_form.referees.info.after_submission') %>
  <% else %>
    <%= t('application_form.referees.info.before_submission') %>
  <% end %>
</p>

<% @application_form.application_references.includes(:application_form).each do |referee| %>
  <%= render(SummaryCardComponent.new(rows: referee_rows(referee), editable: @editable)) do %>
    <%= render(SummaryCardHeaderComponent.new(title: t('application_form.referees.nth_referee')[referee.ordinal], heading_level: @heading_level)) do %>
      <% if FeatureFlag.active?('candidate_cancels_reference') %>
        <div class="app-summary-card__actions">
          <%= link_to candidate_interface_destroy_referee_path(referee.id), class: 'govuk-link' do %>
            <%= t('application_form.referees.delete') %>
            <span class="govuk-visually-hidden"> <%= referee.name %></span>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<% if show_missing_banner? %>
  <%= render(SectionMissingBannerComponent.new(section: :references, section_path: candidate_interface_referees_path, text: t('review_application.references.incomplete', minimum_references: minimum_references), error: @missing_error)) %>
<% end %>
