<p class="govuk-body">
  <% if @application_form.submitted? %>
    <%= t('application_form.referees.info.after_submission') %>
  <% elsif @application_form.application_references.empty? %>
    <%= t('application_form.referees.info.before_submission') %>
  <% end %>
</p>

<% @application_form.application_references.includes(:application_form).each do |referee| %>
  <%= render(SummaryCardComponent.new(rows: referee_rows(referee), editable: @editable && referee.editable?)) do %>
    <%= render(SummaryCardHeaderComponent.new(title: "#{TextOrdinalizer::ORDINALIZE_MAPPING[referee.ordinal]&.capitalize} referee", heading_level: @heading_level)) do %>

      <% if FeatureFlag.active?('candidate_can_cancel_reference') && referee.feedback_requested? %>
        <div class="app-summary-card__actions">
          <%= link_to candidate_interface_confirm_cancel_referee_path(referee.id), class: 'govuk-link' do %>
            <%= t('application_form.referees.cancel') %>
            <span class="govuk-visually-hidden"> <%= referee.name %></span>
          <% end %>
        </div>
      <% elsif @editable %>
        <div class="app-summary-card__actions">
          <%= link_to candidate_interface_confirm_destroy_referee_path(referee.id), class: 'govuk-link' do %>
            <%= t('application_form.referees.delete') %>
            <span class="govuk-visually-hidden"> <%= referee.name %></span>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<% if show_missing_banner? %>
  <%= render(CandidateInterface::SectionMissingBannerComponent.new(section: :references, section_path: candidate_interface_referees_path, text: t('review_application.references.incomplete', minimum_references: minimum_references), error: @missing_error)) %>
<% end %>
