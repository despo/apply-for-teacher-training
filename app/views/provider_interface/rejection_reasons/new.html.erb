<%= form_with model: @reasons_form, url: provider_interface_rejection_reasons_path do |f| %>
  <%= f.object.errors.inspect %>
  <%= params.inspect %>
  <%= f.govuk_error_summary %>

  <div style="display: none;">
  <% @reasons_form.answered_questions.each do |q| %>
    <%= f.fields_for :questions, q do |qf| %>
      <%= qf.hidden_field :requires_reasons %>
      <%= qf.hidden_field :answered, value: true %>
      <%= qf.govuk_radio_buttons_fieldset :y_or_n, legend: { text: q.label } do %>
        <%= qf.hidden_field :label %>
        <%= qf.govuk_radio_button :y_or_n, 'Y', label: { text: 'Yes' } do %>
          <% q.reasons.each do |r| %>
            <%= qf.fields_for :reasons, r do |rf| %>
              <%= rf.govuk_check_boxes_fieldset :value, small: true do %>
                <%= rf.hidden_field :label %>
                <%= rf.govuk_check_box :value, "true", multiple: false, label: { text: r.label } do %>
                  <% r.textareas.each do |ta| %>
                    <%= rf.fields_for :textareas, ta do |tf| %>
                      <%= tf.govuk_text_area :value, rows: 5, max_words: 100 %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <%= qf.govuk_radio_button :y_or_n, 'N', label: { text: 'No' }  %>
      <% end %>
    <% end %>
  <% end %>
  </div>

  <% @reasons_form.questions.each do |q| %>

    <%= f.fields_for :questions, q do |qf| %>
      <%= qf.hidden_field :requires_reasons %>
      <%= qf.govuk_radio_buttons_fieldset :y_or_n, legend: { text: q.label } do %>
        <%= qf.hidden_field :label %>
        <%= qf.govuk_radio_button :y_or_n, 'Y', label: { text: 'Yes' } do %>
          <% q.reasons.each do |r| %>
            <%= qf.fields_for :reasons, r do |rf| %>
              <%= rf.govuk_check_boxes_fieldset :value, small: true do %>
                <%= rf.hidden_field :label %>
                <%= rf.govuk_check_box :value, "true", multiple: false, label: { text: r.label } do %>
                  <% r.textareas.each do |ta| %>
                    <%= rf.fields_for :textareas, ta do |tf| %>
                      <%= tf.hidden_field :label %>
                      <%= tf.govuk_text_area :value, rows: 5, max_words: 100 %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <%= qf.govuk_radio_button :y_or_n, 'N', label: { text: 'No' }  %>
      <% end %>
    <% end %>
  <% end %>

  <%= f.submit %>
<% end %>
